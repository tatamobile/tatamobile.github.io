<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>JNI 方法注册和签名 | TATAMOBILE</title>
  <meta name="author" content="TATAMOBILE">
  
  <meta name="description" content="user growth tech">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="JNI 方法注册和签名"/>
  <meta property="og:site_name" content="TATAMOBILE"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FXZ3M3DJK6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FXZ3M3DJK6');
</script>


  
<!-- Google Adsense -->
<!-- <script data-ad-client="ca-pub-6011041061943855" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->

  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">TATAMOBILE</a></h1>
  <h2><a href="/">安卓源码分析</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-JNI-Function-Name-Override" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2021-12-21T03:35:42.000Z"><a href="/2021/12/21/JNI-Function-Name-Override/">2021-12-21</a></time>
        
  
    <h1 class="p-name title" itemprop="headline name">JNI 方法注册和签名</h1>
  

      
    </header>
    <div class="e-content entry" itemprop="articleBody">
        
      
        <!-- Table of Contents -->
        
        <h2 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h2><p>最近分析一个Android平台上的so，发现JNI函数命名如下：</p>
<img src="/images/jni_function_name.png" class="" title="Java:JNI Function Name " alt="JNI Function Name">
<p>函数名字和自己平时写代码不一样，故重新学习JNI方法的签名规则</p>
<h2 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h2><h3 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h3><p>可以使用javah自动生成JNI函数签名，来探索函数命名规则。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javah -jni 包名.类名</span><br></pre></td></tr></table></figure>

<p>一般类的普通函数</p>
<figure class="highlight java"><figcaption><span>Sample.java</span><a href="/downloads/code/android/com/example/Sample.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sample</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">GetSample</span><span class="params">(<span class="keyword">int</span> n, String s,<span class="keyword">int</span> [] arr)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>执行命令 “javah -jni com.example.Sample” 后生成的c++文件</p>
<figure class="highlight cpp"><figcaption><span>com_example_Sample.h</span><a href="/downloads/code/android/com_example_Sample.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="comment">/* Header for class com_example_Sample */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_com_example_Sample</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_com_example_Sample</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_Sample</span></span><br><span class="line"><span class="comment"> * Method:    GetSample</span></span><br><span class="line"><span class="comment"> * Signature: (ILjava/lang/String;[I)I</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jint JNICALL Java_com_example_Sample_GetSample</span><br><span class="line">  (JNIEnv *, jclass, jint, jstring, jintArray);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>内部类的函数和重载函数</p>
<figure class="highlight java"><figcaption><span>Native.java</span><a href="/downloads/code/android/com/example/Native.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Native</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">GetSample</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">GetSample</span><span class="params">(<span class="keyword">int</span> n, String s,<span class="keyword">int</span> [] arr)</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Stub</span></span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">GetSample</span><span class="params">()</span></span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>执行命令 “javah -jni com.example.Native” 后生成的c++文件</p>
<figure class="highlight cpp"><figcaption><span>com_example_Native.h</span><a href="/downloads/code/android/com_example_Native.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="comment">/* Header for class com_example_Native */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_com_example_Native</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_com_example_Native</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_Native</span></span><br><span class="line"><span class="comment"> * Method:    GetSample</span></span><br><span class="line"><span class="comment"> * Signature: ()I</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jint JNICALL Java_com_example_Native_GetSample__</span><br><span class="line">  (JNIEnv *, jclass);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_Native</span></span><br><span class="line"><span class="comment"> * Method:    GetSample</span></span><br><span class="line"><span class="comment"> * Signature: (ILjava/lang/String;[I)I</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jint JNICALL Java_com_example_Native_GetSample__ILjava_lang_String_2_3I</span><br><span class="line">  (JNIEnv *, jclass, jint, jstring, jintArray);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>com_example_Native_Stub.h</span><a href="/downloads/code/android/com_example_Native_Stub.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="comment">/* Header for class com_example_Native_Stub */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_com_example_Native_Stub</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_com_example_Native_Stub</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_Native_Stub</span></span><br><span class="line"><span class="comment"> * Method:    GetSample</span></span><br><span class="line"><span class="comment"> * Signature: ()I</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jint JNICALL Java_com_example_Native_00024Stub_GetSample</span><br><span class="line">  (JNIEnv *, jclass);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="函数签名"><a href="#函数签名" class="headerlink" title="函数签名"></a>函数签名</h3><p>一般函数的JNI接口函数命名：<strong>Java_包名_类名_方法名</strong>。<br>比如包com.example下的类Sample中的GetSample函数对应的JNI函数名 ：<br>“<em>Java_com_example_Sample_GetSample</em>” 。</p>
<p>重载函数的JNI接口函数命名：<strong>Java_包名_类名_方法名__参数签名</strong>。<br>比如包名com.example下的类Native中的GetSample函数对应的JNI函数名：<br>“<em>Java_com_example_Native_GetSample__ILjava_lang_String_2_3I</em>” 。</p>
<p>内部类Stub的JNI函数名：<br>“<em>Java_com_example_Native_00024Stub_GetSample</em>” 。</p>
<h3 id="类型签名"><a href="#类型签名" class="headerlink" title="类型签名"></a>类型签名</h3><table>
<thead>
<tr>
<th>类型签名</th>
<th>Java类型</th>
</tr>
</thead>
<tbody><tr>
<td>Z</td>
<td>boolean</td>
</tr>
<tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
</tr>
<tr>
<td>Lfully-qulitied-class;</td>
<td>全限定类</td>
</tr>
<tr>
<td>[type</td>
<td>type[] 数组</td>
</tr>
<tr>
<td>(argtypes)rettype</td>
<td>方法类型</td>
</tr>
</tbody></table>
<h3 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h3><p>JNI在函数命名时采用名字扰乱方案，以保证所有的Unicode字符都能转换为有效的C函数名，所有的“/”,无论是包名中的还是全限定类名中的，均使用“_”代替，用_0,…,_9来代替转义字符。</p>
<table>
<thead>
<tr>
<th>转义字符序列</th>
<th>表示</th>
</tr>
</thead>
<tbody><tr>
<td>_0XXXX</td>
<td>Unicode字符XXXX</td>
</tr>
<tr>
<td>_1</td>
<td>字符“_”</td>
</tr>
<tr>
<td>_2</td>
<td>签名中的字符“；”</td>
</tr>
<tr>
<td>_3</td>
<td>签名中的字符“[”</td>
</tr>
</tbody></table>
<p>比如 “IdsSupplier_00024Stub” 中的”_00024” 表示字符”$” 。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/superxlcr/article/details/72724096">JNI 方法注册与签名</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/nuliniaoboke/archive/2012/10/31/2747715.html">JNI使用规范详解</a></li>
</ul>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Reverse-Engineering/">Reverse Engineering</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/java/">java</a>, <a href="/tags/jni/">jni</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      
<div id="gitalk-container"></div>   
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '15e82eced18a4f3699f5',
        clientSecret: '9159132c67a2722bbee0d59ff3026bb361bcd81c',
        repo: 'tatamobile_commnets',
        owner: 'vforkliu',
        admin: ["vforkliu"],
        id: '2021-12-21 11:35:42',
        title: 'JNI 方法注册和签名',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
</script>
      
  
</section>



  <nav id="postnav">
    
    
      <p>上一篇 : <a href="/2022/02/09/Android-Process-Memory-Layout-What-s-the-Stack-Top-of-Main-Thread/" >Android进程内存布局：主线程的栈顶是多少？</a></p>
    
   
    
      <p>下一篇 : <a href="/2021/07/26/Python-Metaclass/" >Python进阶 : 元类（Metaclass）</a></p>
    
    
    <div class="clearfix"></div>
  </nav>
</div></div>
    <aside id="sidebar" class="alignright">
        
    <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="as_sitesearch" value="tatamobile.net">
  </form>
</div>


    
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/CMake/">CMake</a><small>1</small></li>
  
    <li><a href="/categories/Python/">Python</a><small>2</small></li>
  
    <li><a href="/categories/Qt/">Qt</a><small>1</small></li>
  
    <li><a href="/categories/Reverse-Engineering/">Reverse Engineering</a><small>5</small></li>
  
  </ul>
</div>


    
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/C/">C++</a><small>1</small></li>
  
    <li><a href="/tags/CMake/">CMake</a><small>1</small></li>
  
    <li><a href="/tags/Decorator/">Decorator</a><small>1</small></li>
  
    <li><a href="/tags/Metaclass/">Metaclass</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>2</small></li>
  
    <li><a href="/tags/Qt/">Qt</a><small>1</small></li>
  
    <li><a href="/tags/android/">android</a><small>3</small></li>
  
    <li><a href="/tags/arm/">arm</a><small>4</small></li>
  
    <li><a href="/tags/elf/">elf</a><small>1</small></li>
  
    <li><a href="/tags/java/">java</a><small>1</small></li>
  
    <li><a href="/tags/jni/">jni</a><small>1</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>1</small></li>
  
    <li><a href="/tags/unicorn/">unicorn</a><small>1</small></li>
  
  </ul>
</div>


        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6011041061943855" crossorigin="anonymous"></script>
        <!-- 侧边栏广告 -->
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-6011041061943855"
            data-ad-slot="2644505017"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2024 TATAMOBILE|<a href="http://beian.miit.gov.cn/"; target=_blank>粤ICP备2020090023号</a>|<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030902002346">粤公网安备 44030902002346号</a>
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
